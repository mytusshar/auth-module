<html>
    <head>
        <title> Response </title>
    </head>

    <body>
        <h2> Login Status</h2>
        <br>
        <h3 id="output"></h3>
    </body>

    <script>
        const SERVER_ADDRESS = "http://localhost:3000";
        const PROFILE = SERVER_ADDRESS + "/profile";

        function getCookieValue(key) {
            var values = document.cookie.match('(^|;)\\s*' + key + '\\s*=\\s*([^;]+)');
            return values ? values.pop() : '';
        }

        var recievedDataOperation = function(data) {
            data.cookie = getCookieValue("userId");
            window.opener.postMessage(data, '*');
            window.close();
            document.getElementById("output").innerHTML = "Logged in as " + data.name;
        }

        var handleError = function(error) {
            log('Request failed', error);
        }

        function getUserData(id) {
            var url = PROFILE + "?id=" + id;
            fetch(url)
            .then((response) => response.json())
            .then(recievedDataOperation)
            .catch(handleError);
        }

        window.onload = function(){
            var id = getCookieValue("userId");
            //console.log("cookies", JSON.stringify(document.cookie));
            // var request = new XMLHttpRequest();
            // console.log("cookies", JSON.stringify(request.getAllResponseHeaders));
            getUserData(id);
        }
    </script>

</html>