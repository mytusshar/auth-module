<html>
    <head>
        <title> Response </title>
    </head>

    <body>
        <h2> Login Status</h2>
        <br>
        <h3 id="output"></h3>
    </body>

    <script>
        const COOKIE_KEY = "userId";

        function getCookieValue(key) {
            var values = document.cookie.match('(^|;)\\s*' + key + '\\s*=\\s*([^;]+)');
            return values ? values.pop() : '';
        }

        function convertToJSON(data) {
            data = unescape(data);
            var str = JSON.stringify(data);
            var sub_data =  str.substr(3, str.length - 4);
            var result = "";

            for(var i=0; i<sub_data.length; i++) {
                if(sub_data.charAt(i) == "\\" && sub_data.charAt(i+1) == "\"") {
                    continue;
                }
                result += sub_data.charAt(i);
            }

            return JSON.parse(result);
        }

        window.onload = function(){
            console.log("cookies", JSON.stringify(document.cookie));
            var cookie_data = getCookieValue(COOKIE_KEY);
            var user_data = convertToJSON(cookie_data);

            window.opener.postMessage(user_data, '*');         
            document.getElementById("output").innerHTML = "Logged in as " + user_data.message;
            window.close(); 
        }

    </script>

</html>