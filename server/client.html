<html>
	<head>
		<title>Generalized Login Module</title>

		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
			integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
			crossorigin="anonymous">
	</head>

	<body>
		        
        <div class="container">
            <h1 class="display-4 mb-4">Generalized Login Module</h1>
            <hr>
            <button id="btn-abbreviate" class="btn btn-warning" onclick="openInNewTab()"> Login with Facebook</button>
            <hr><br><br>
            <h2>Output: </h2>
            <h3 id="output"></h3>
        </div>
        
        <script>            
            function getUserData() {
                const url = "http://localhost:3000/profile";
                console.log("inside getUserData");
                fetch(url)
                .then((res) => res.json())
                .then((data) => {
                                        
                    if(data.isLoggedIn) {
                        var result = "Name: " + data.name + "<br>"
                                + "Email: " + data.email + "<br>" 
                                + "ID: " + data.id + "<br>"
                                + "LoggedInStatus: " + data.isLoggedIn;

                        document.getElementById("output").innerHTML = result;

                        stopTimer()
                    }
                    console.log("recieved: " + data);
                })
                .catch((err) => {
                    console.log(err);
                    document.getElementById("output").innerHTML = err;
                })

            }

            var timer;
            function startRequestingData() {
                timer = setInterval(getUserData, 5000);
            }

            function stopTimer() {
                clearInterval(timer);
            }

            function openInNewTab() {
                let params = `scrollbars=no,resizable=no,status=no,location=no,toolbar=no,menubar=no,
                            width=600,height=300,left=100,top=100`;

                var url = "http://localhost:3000/auth/facebook";
                var win = window.open(url, '_blank', params);
                win.focus();
                startRequestingData();                
            }          

        </script>		
	</body>
</html>